# Copyright © 2019-2020 Brandon Li. All rights reserved.

#!————————————————————————————————————————————————————————————————————————————*!
# Entry point for https://app.wercker.com/. Instructs wercker to check that
# every branch passes linting and testing, activated on every commit. For more
# documentation, see https://devcenter.wercker.com/.
#
# IMPORTANT: This file was auto-generated by `grunt generate-wercker`. It is
#            recommended to not modify this file. For more information, see
#            https://github.com/brandonLi8/grunt-config/.
#
# @author Brandon Li <brandon.li820@gmail.com>
#!————————————————————————————————————————————————————————————————————————————*!

box: node                           # use the default Node.js container
build:
  steps:                            # define the steps executed on every build

    - script:                       # install Node.js first
      name: Install Node.js
      code: |
        npm cache clean --f         # clear all data from the npm cache
        npm i                       # install dependencies

        echo "node: $( node -v )"   # display the Node version
        echo "npm: $( npm -v )"     # display the npm version

    - script:                       # install grunt globally
      name: Install Grunt
      code: npm i -g grunt-cli

    - script:                       # run ci testing commands
      name: Continuous Integration
      code: |
        grunt eslint --no-cache     # ensure everything is linted
        npm test --if-present       # ensure defined tests pass


    - script:
      name: Check Copyright Statements
      code: |
        grunt update-copyright
        if ! git diff-index --quiet HEAD --; then
          tput setaf 1 && tput bold;
          echo Error. Changes detected when running \`grunt update-copyright\`:;
          tput sgr0;
          git status --short;
          exit 1;
        fi

    - script:
      code: echo "Bye!"