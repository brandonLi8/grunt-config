# Copyright © {{COPYRIGHT_YEARS}} {{AUTHOR}}. All rights reserved.

#!————————————————————————————————————————————————————————————————————————————*!
# GitHub action for deploying commits to the production branch to heroku.
#
# Requires the HEROKU_API_TOKEN secret. See https://help.heroku.com/PBGP6IDE/
# for documentation on generating this token. You will then need to create a
# secret in the GitHub repository that points to this token. See
# https://help.github.com/en/actions for more documentation.
#
# Note: This file was auto-generated by `grunt generate-deploy-heroku`. It is
#       not recommended to modify this file. For more information, see
#       https://github.com/brandonLi8/grunt-config/.
#
# @author {{AUTHOR}} <{{AUTHOR_EMAIL}}>
#!————————————————————————————————————————————————————————————————————————————*!

name: deploy                        # workflow name

on:
  push:                             # Activate on the push event/
    branches:
      - production                  # Only activate on the production branch.

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1    # Checkout the source code of the project.

    - name: setup node             # Setup Node.js
      uses: actions/setup-node@v1

    - run: npm cache clean --f     # Clear the npm cache if it exists.
    - run: npm install             # Install dependencies.

    - name: lint                   # Ensure all source code is lint-free.
      run: grunt eslint --no-cache

    - name: copyright              # Ensure that all source code copyright
      run: grunt check-copyright   # statements are correct.

    - name: test                   # Ensure that project-defined tests pass.
      run: npm test --if-present

    - name: deploy to heroku       # Finally deploy to heroku.
      env:
        HEROKU_API_TOKEN: ${{ secrets.HEROKU_API_TOKEN }}
      if: github.ref == 'refs/heads/production' && job.status == 'success'
      run: |
        git push \
          https://heroku:$HEROKU_API_TOKEN@git.heroku.com/${{REPO_NAME}}.git \
          origin/master:master